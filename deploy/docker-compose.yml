# OpenVPN 部署：host 网络模式，数据持久化在 volume
# 使用方式见 deploy/README.md
services:
  openvpn:
    build:
      context: ..
      dockerfile: Dockerfile
      args:
        BASE_IMAGE: ${BASE_IMAGE:-ubuntu:24.04}
    image: openvpn-install-deploy:latest
    container_name: openvpn
    hostname: openvpn
    network_mode: host
    privileged: true
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    sysctls:
      - net.ipv4.ip_forward=1
    volumes:
      - openvpn-data:/etc/openvpn
    # 保持运行以便 systemd 与 OpenVPN 服务常驻；用户通过 exec 进入终端操作
    stdin_open: true
    tty: true
    restart: unless-stopped

volumes:
  openvpn-data:
